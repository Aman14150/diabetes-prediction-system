<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Diabetes Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <h2 id="menu">ü©∫ Diabetes Prediction System</h2>
            <ul>
                <li><a href="/" class="{% if not show_patients %}active{% endif %}">
                        <i class="fa-solid fa-vials"></i>
                        Test</a>
                </li>
                <li><a href="/patients" class="{% if show_patients %}active{% endif %}">
                        <i class="fa-solid fa-users"></i>
                        Patients</a>
                </li>
            </ul>
        </aside>

        <main class="content">
            {% if not show_patients %}
            <!-- Test Form -->
            <div class="card">
                <h2>Predict Diabetes</h2>
                <div class="guidelines">
                    <strong>Guidelines:</strong><br>
                    - High Glucose (>140), BMI (>30) ‚Üí likely ‚ÄúDiabetic‚Äù<br>
                    - Normal Glucose (~100), BMI (~25), Age <35 ‚Üí likely ‚ÄúNon-Diabetic‚Äù<br>
                        - Fill all fields carefully for accurate prediction
                </div>

                <form id="diabetesForm" action="/predict" method="post">
                    <input type="text" name="name" placeholder="Full Name" required>
                    <input type="tel" name="mobile" placeholder="Mobile Number" required>
                    <input type="number" name="Pregnancies" placeholder="Pregnancies (e.g., 0-10)" step="any" required>
                    <input type="number" name="Glucose" placeholder="Glucose (mg/dL, e.g., 80-180)" step="any" required>
                    <input type="number" name="BloodPressure" placeholder="Blood Pressure (mmHg, e.g., 60-120)"
                        step="any" required>
                    <input type="number" name="SkinThickness" placeholder="Skin Thickness (mm, e.g., 10-50)" step="any"
                        required>
                    <input type="number" name="Insulin" placeholder="Insulin (¬µU/mL, e.g., 15-276)" step="any" required>
                    <input type="number" name="BMI" placeholder="BMI (kg/m¬≤, e.g., 18-35)" step="any" required>
                    <input type="number" name="DiabetesPedigreeFunction"
                        placeholder="Diabetes Pedigree Function (e.g., 0.1-2.5)" step="any" required>
                    <input type="number" name="Age" placeholder="Age (years, e.g., 20-80)" step="any" required>
                    <div class="button-group">
                        <button type="submit" id="predictBtn">Predict</button>
                        <button type="button" id="clearBtn">Clear</button>
                    </div>

                    {% if prediction_text %}
                    <div class="prediction">{{ prediction_text }}</div>
                    {% else %}
                    <div class="prediction">&nbsp;</div>
                    {% endif %}
                </form>
            </div>
            {% else %}
            <!-- Patients Table -->
            <div class="card">
                <h2>Patients List</h2>
                <!-- Search & Export -->
                <div style="margin-bottom:10px;">
                    <form method="get" action="/patients" style="display:flex; gap:10px; align-items:center;">
                        <input type="text" name="search" placeholder="Search name/prediction..." value="{{ search }}">
                        <button type="submit" class="button">Search</button>
                        <a href="{{ url_for('export_csv') }}" class="button" style="background:#10b981;">Export CSV</a>
                        <select name="per_page" onchange="this.form.submit()">
                            {% for n in [5,10,15,20] %}
                            <option value="{{ n }}" {% if per_page==n %}selected{% endif %}>{{ n }} per page</option>
                            {% endfor %}
                        </select>
                    </form>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Sr. No.</th> <!-- Serial Number -->
                            {% for col in patient_columns[1:] %} <!-- Skip DB ID -->
                            <th>{{ col|capitalize }}</th>
                            {% endfor %}
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in patient_data %}
                        <tr>
                            <td>{{ loop.index }}</td> <!-- Sr. No. using Jinja loop.index -->
                            {% for item in row[1:] %} <!-- Skip DB ID -->
                            <td>{{ item }}</td>
                            {% endfor %}
                            <td>
                                <form action="{{ url_for('delete_patient', patient_id=row[0]) }}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="delete-btn">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <!-- Pagination -->
                <div style="margin-top:15px; text-align:center;">
                    {% if page > 1 %}
                    <a href="{{ url_for('patients', page=page-1, per_page=per_page, search=search) }}">Prev</a>
                    {% endif %}
                    Page {{ page }} of {{ total_pages }}
                    {% if page < total_pages %} <a
                        href="{{ url_for('patients', page=page+1, per_page=per_page, search=search) }}">Next</a>
                        {% endif %}
                </div>
            </div>

            {% endif %}
        </main>
    </div>

    <script>
        document.getElementById('clearBtn')?.addEventListener('click', function () {
            document.getElementById('diabetesForm')?.reset();
        });
    </script>
</body>

</html>