<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Diabetes Prediction</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 id="menu">ü©∫ Diabetes Prediction System</h2>
      <ul>
        <li>
          <a href="/" class="{% if not show_patients %}active{% endif %}">
            <i class="fa-solid fa-vials"></i> Test
          </a>
        </li>
        <li>
          <a href="/patients" class="{% if show_patients %}active{% endif %}">
            <i class="fa-solid fa-users"></i> Patients
          </a>
        </li>
      </ul>
    </aside>

    <main class="content">
      {% if not show_patients %}
      <!-- ========== TEST FORM SECTION ========== -->
      <div class="card">
        <h2>Predict Diabetes</h2>

        <div class="guidelines">
          <strong>Guidelines:</strong><br>
          - High Glucose (>140), BMI (>30) ‚Üí likely ‚ÄúDiabetic‚Äù<br>
          - Normal Glucose (~100), BMI (~25), Age <35 ‚Üí likely ‚ÄúNon-Diabetic‚Äù<br>
          - Fill all fields carefully for accurate prediction
        </div>

        <form id="diabetesForm" action="/predict" method="post">
          <div class="form-grid">
            <input type="text" name="name" placeholder="Full Name" required>
            <input type="tel" name="mobile" placeholder="Mobile Number" required>
            <input type="number" name="Pregnancies" placeholder="Pregnancies (e.g., 0-10)" step="any" required>
            <input type="number" name="Glucose" placeholder="Glucose (mg/dL, e.g., 80-180)" step="any" required>
            <input type="number" name="BloodPressure" placeholder="Blood Pressure (mmHg, e.g., 60-120)" step="any"
              required>
            <input type="number" name="SkinThickness" placeholder="Skin Thickness (mm, e.g., 10-50)" step="any" required>
            <input type="number" name="Insulin" placeholder="Insulin (¬µU/mL, e.g., 15-276)" step="any" required>
            <input type="number" name="BMI" placeholder="BMI (kg/m¬≤, e.g., 18-35)" step="any" required>
            <input type="number" name="DiabetesPedigreeFunction"
              placeholder="Diabetes Pedigree Function (e.g., 0.1-2.5)" step="any" required>
            <input type="number" name="Age" placeholder="Age (years, e.g., 20-80)" step="any" required>
          </div>

          <div class="button-group">
            <button type="submit" id="predictBtn">Predict</button>
            <button type="button" id="clearBtn">Clear</button>
          </div>

          <!-- Prediction Result -->
          {% if prediction_text %}
          <div class="prediction-result">
            <strong>Prediction Result:</strong>
            <span>{{ prediction_text }}</span>
          </div>
          {% endif %}
        </form>
      </div>

      {% else %}
      <!-- ========== PATIENTS TABLE SECTION ========== -->
      <div class="card">
        <h2>Patients List</h2>

        <!-- Search + Export -->
        <div class="table-actions">
          <form method="get" action="/patients" class="search-form">
            <input type="text" name="search" placeholder="Search name/prediction..." value="{{ search }}">
            <button type="submit" class="button">Search</button>
            <a href="{{ url_for('export_csv') }}" class="button export">Export CSV</a>
            <select name="per_page" onchange="this.form.submit()">
              {% for n in [5,10,15,20] %}
              <option value="{{ n }}" {% if per_page==n %}selected{% endif %}>{{ n }} per page</option>
              {% endfor %}
            </select>
          </form>
        </div>

        <!-- Table -->
        <table>
          <thead>
            <tr>
              <th>Sr. No.</th>
              {% for col in patient_columns[1:] %}
              <th>{{ col|capitalize }}</th>
              {% endfor %}
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for row in patient_data %}
            <tr>
              <td>{{ loop.index }}</td>
              {% for item in row[1:] %}
              {% if loop.index == patient_columns|length - 1 %}
              <!-- Color-coded Prediction -->
              <td class="prediction-cell {{ 'diabetic' if item == 'Diabetic' else 'non-diabetic' }}">{{ item }}</td>
              {% else %}
              <td>{{ item }}</td>
              {% endif %}
              {% endfor %}
              <td>
                <form action="{{ url_for('delete_patient', patient_id=row[0]) }}" method="post" style="display:inline;">
                  <button type="submit" class="delete-btn">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination">
          {% if page > 1 %}
          <a href="{{ url_for('patients', page=page-1, per_page=per_page, search=search) }}">Prev</a>
          {% endif %}
          <span>Page {{ page }} of {{ total_pages }}</span>
          {% if page < total_pages %}
          <a href="{{ url_for('patients', page=page+1, per_page=per_page, search=search) }}">Next</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </main>
  </div>

  <script>
    document.getElementById('clearBtn')?.addEventListener('click', function () {
      document.getElementById('diabetesForm')?.reset();
      document.querySelector('.prediction-result span')?.remove();
    });
  </script>
</body>

</html>
